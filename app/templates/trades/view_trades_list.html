{% extends "base.html" %}
{% import "macros/_pagination_helpers.html" as pagi %} {# Assuming you might create this for pagination #}

{% block title %}
    {{ title }} - Combined Trading Journal
{% endblock %}

{% block page_header %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>{{ title }}</h1>
        <a href="{{ url_for('trades.add_trade') }}" class="btn btn-success">
            <i class="fas fa-plus me-1"></i> Log New Trade
        </a>
    </div>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        {% if trades %}
        <div class="table-responsive">
            <table class="table table-hover table-striped">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Instrument</th>
                        <th>Direction</th>
                        <th>Entries</th>
                        <th>Avg. Entry</th>
                        <th>Exits</th>
                        <th>Avg. Exit</th>
                        <th>Gross P&L</th>
                        <th>R-Value</th>
                        <th>Model</th>
                        <th>Tags</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for trade in trades %}
                    <tr>
                        <td>{{ trade.trade_date|format_date('%d-%b-%Y') }}</td>
                        <td>{{ trade.instrument }}</td>
                        <td>
                            {% if trade.direction == 'Long' %}
                                <span class="badge bg-success">{{ trade.direction }}</span>
                            {% elif trade.direction == 'Short' %}
                                <span class="badge bg-danger">{{ trade.direction }}</span>
                            {% else %}
                                {{ trade.direction }}
                            {% endif %}
                        </td>
                        <td>{{ trade.total_contracts_entered }}</td>
                        <td>{{ "%.2f"|format(trade.average_entry_price) if trade.average_entry_price is not none else 'N/A' }}</td>
                        <td>{{ trade.total_contracts_exited }}</td>
                        <td>{{ "%.2f"|format(trade.average_exit_price) if trade.average_exit_price is not none else 'N/A' }}</td>
                        <td class="{{ 'text-success' if trade.gross_pnl > 0 else ('text-danger' if trade.gross_pnl < 0 else '') }}">
                            {{ "$%.2f"|format(trade.gross_pnl) if trade.gross_pnl is not none else '$0.00' }}
                        </td>
                        <td>
                            {% if trade.pnl_in_r is not none %}
                                <span class="{{ 'text-success' if trade.pnl_in_r > 0 else ('text-danger' if trade.pnl_in_r < 0 else '') }}">
                                    {{ "%.2f"|format(trade.pnl_in_r) }}R
                                </span>
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>{{ trade.trading_model.name if trade.trading_model else 'N/A' }}</td>
                        <td>
                            {% if trade.tags %}
                                {% set tag_list = trade.tags.split(',') %}
                                {% for tag_item in tag_list %}
                                    <span class="badge bg-info me-1">{{ tag_item.strip() }}</span>
                                {% endfor %}
                            {% else %}
                            N/A
                            {% endif %}
                        </td>
                        <td>
                            <a href="#" class="btn btn-sm btn-info mb-1" title="View Details (Soon)"><i class="fas fa-eye"></i></a>
                            <a href="#" class="btn btn-sm btn-warning mb-1" title="Edit (Soon)"><i class="fas fa-edit"></i></a>
                            <a href="#" class="btn btn-sm btn-danger mb-1" title="Delete (Soon)" onclick="return confirm('Are you sure you want to delete this trade?');"><i class="fas fa-trash"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            No trades logged yet. <a href="{{ url_for('trades.add_trade') }}" class="alert-link">Log your first trade!</a>
        </div>
        {% endif %}
    </div>
</div>

{# Pagination #}
{% if pagination and pagination.pages > 1 %}
<div class="mt-4">
    {{ pagi.render_pagination(pagination, 'trades.view_trades_list') }}
</div>
{% endif %}

{% endblock %}